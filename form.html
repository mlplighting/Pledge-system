<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Pledge Form</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; background:#f9f9f9; padding:40px; }
    form { max-width:520px; margin:auto; background:#fff; padding:28px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,.1); }
    h2 { text-align:center; margin-top:0; }
    label { display:block; margin:12px 0 6px; font-weight:600; }
    .row { display:flex; gap:10px; }
    .row .col { flex:1; }
    input, button { width:100%; padding:12px; font-size:16px; border:1px solid #ddd; border-radius:8px; box-sizing:border-box; }
    .hint { font-size:12px; color:#777; margin-top:4px; }

    .btn {
      border:none;
      background:#1976d2;
      color:#fff;
      font-weight:600;
      cursor:pointer;
      margin-top:16px;
      transition:opacity .2s ease;
    }
    .btn:disabled {
      background:#9e9e9e;
      cursor:not-allowed;
      opacity:0.9;
    }

    .msg { text-align:center; margin-top:12px; font-size:14px; color:#0a7; display:none; }
    .err { text-align:center; margin-top:12px; font-size:14px; color:#c00; display:none; }
  </style>
</head>
<body>
  <h2>Pledge Form</h2>

  <form id="pledgeForm" method="POST" action="https://script.google.com/macros/s/AKfycbxLodrpbwKU4SZPVZVrJWwDKHYZ4PyaPzFxdeU94ca3qfP8m4QS8nx4pQobPnKfFXxu0A/exec" novalidate>
    <div class="row">
      <div class="col">
        <label for="first_name">First name</label>
        <input type="text" id="first_name" name="first_name" required autocomplete="given-name" />
      </div>
      <div class="col">
        <label for="last_name">Last name</label>
        <input type="text" id="last_name" name="last_name" required autocomplete="family-name" />
      </div>
    </div>

    <label for="phone">Phone</label>
    <input type="tel" id="phone" name="phone" inputmode="numeric" maxlength="12" placeholder="123-456-7890" required />
    <div class="hint">Format: 123-456-7890</div>

    <label for="email">Email</label>
    <input type="email" id="email" name="email" required autocomplete="email" />

    <label for="amount_display">Pledge Amount</label>
    <input type="text" id="amount_display" placeholder="$10,000" required />
    <input type="hidden" id="amount" name="amount" />

    <button type="submit" id="submitBtn" class="btn">Submit</button>
    <div id="ok" class="msg">Thanks! Pledge submitted.</div>
    <div id="bad" class="err">Please enter a valid amount.</div>
  </form>

  <script>
    // Format phone
    const phone = document.getElementById('phone');
    phone.addEventListener('input', () => {
      const digits = phone.value.replace(/\D/g, '').slice(0, 10);
      let out = digits;
      if (digits.length > 6) out = digits.slice(0,3) + '-' + digits.slice(3,6) + '-' + digits.slice(6);
      else if (digits.length > 3) out = digits.slice(0,3) + '-' + digits.slice(3);
      phone.value = out;
    });

    // Format currency
    const amountDisplay = document.getElementById('amount_display');
    const amountHidden  = document.getElementById('amount');
    function formatCurrencyDisplay(digits) {
      if (!digits) return '';
      const withCommas = digits.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
      return '$' + withCommas;
    }
    amountDisplay.addEventListener('input', () => {
      const digits = amountDisplay.value.replace(/\D/g, '');
      amountDisplay.value = formatCurrencyDisplay(digits);
      amountHidden.value = digits ? String(parseInt(digits, 10)) : '';
    });

    // Submit handling
    const form = document.getElementById('pledgeForm');
    const okMsg = document.getElementById('ok');
    const badMsg = document.getElementById('bad');
    const btn = document.getElementById('submitBtn');
    form.addEventListener('submit', (e) => {
      e.preventDefault();
      badMsg.style.display = 'none';
      okMsg.style.display = 'none';
      const digits = amountDisplay.value.replace(/\D/g, '');
      amountHidden.value = digits ? String(parseInt(digits, 10)) : '';
      if (!form.first_name.value.trim() || !form.last_name.value.trim() ||
          !form.phone.value.trim() || !form.email.value.trim() || !amountHidden.value) {
        badMsg.textContent = 'Please complete all fields with a valid amount.';
        badMsg.style.display = 'block';
        return;
      }
      btn.disabled = true;
      const original = btn.textContent;
      btn.textContent = 'Submittingâ€¦';
      fetch(form.action, { method: 'POST', body: new FormData(form) })
        .then(() => { okMsg.style.display = 'block'; form.reset(); amountHidden.value = ''; })
        .catch(() => { badMsg.textContent = 'Error submitting. Please try again.'; badMsg.style.display = 'block'; })
        .finally(() => { btn.disabled = false; btn.textContent = original; });
    });
  </script>
</body>
</html>
